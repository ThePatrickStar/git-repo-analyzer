{% extends 'base.html' %}

{% block content %}

    {% for commit in commits %}
        <div class="card mx-auto" style="margin: 1rem">
            <div class="card-block">
                <div class="row" style="margin-bottom: 0.5rem">
                    <div class="col-md-6 col-8 align-self-center">
                        <h5 class="card-title align-middle text-megna">{{commit.binsha}}</h5>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-4 align-self-center">
                        <strong>Committer</strong>
                    </div>
                    <div class="col-8 align-self-center">
                        {{commit.committer}}
                    </div>
                </div>
                <div class="row ">
                    <div class="col-4 align-self-center">
                        <strong>Committed Datetime</strong>
                    </div>
                    <div class="col-8 align-self-center">
                        {{commit.committed_datetime}}
                    </div>
                </div>
                <div class="row" style="margin-bottom: 0.5rem">
                    <div class="col-4 align-self-center">
                        <strong>Message</strong><br/>
                    </div>
                    <div class="col-8 align-self-center">
                        {{commit.msg}}
                    </div>
                </div>
                <button  type="button" data-toggle="collapse" data-target="#div_hidden_data{{commit.id}}" aria-expanded="false" aria-controls="div_hidden_data{{commit.id}}" class="btn btn-outline-primary btn-block" role="button" style="margin-bottom: 1rem">
                    <i class="fa fa-list-alt"></i>
                    Toggle Diffs
                </button >
                <div  class="collapse" id="div_hidden_data{{commit.id}}">
                    <!--<div class="row text-info">-->
                        {% for diff in commit.diffs %}
                        <div id="div_diff_{{commit.id}}_{{diff.id}}">
                            {{diff.content}}
                        </div>
                        {% endfor %}
                    <!--</div>-->
                </div>
            </div>
        </div>
    {% endfor %}
    <div id="line-by-line">

    </div>
    <div id="line-by-line2">

    </div>
{% endblock %}


{% block js_code %}
    <script type="text/javascript">
        $(document).ready(function() {
            var configure = {inputFormat: 'diff', showFiles: true, matching: 'lines', outputFormat: 'side-by-side'};
            {% for commit in commits %}
                {% for diff in commit.diffs %}
                    var diff_str = '{{diff.content}}';
//                    var output = Diff2Html.getPrettyHtml(diff_str, configure);
//                    $('#div_diff_'+{{commit.id}}+'_'+{{diff.id}}).html(output);
                    var diff2htmlUi = new Diff2HtmlUI({diff: diff_str});
                    diff2htmlUi.draw('#div_diff_'+{{commit.id}}+'_'+{{diff.id}}, configure);
                    // diff2htmlUi.highlightCode('#div_diff_'+{{commit.id}}+'_'+{{diff.id}});
//                    diff2htmlUi.fileListCloseable('#div_diff_'+{{commit.id}}+'_'+{{diff.id}}, false);
                {% endfor %}
            {% endfor %}
            // var lineDiffExample = "" +
            //     "--- a/server/vendor/golang.org/x/sys/unix/zsyscall_linux_mipsle.go\\n+++ b/server/vendor/golang.org/x/sys/unix/zsyscall_linux_mipsle.go\\n@@ -1035,6 +1035,17 @@ func Prctl(option int, arg2 uintptr, arg3 uintptr, arg4 uintptr, arg5 uintptr) (\\n \\n // THIS FILE IS GENERATED BY THE COMMAND AT THE TOP; DO NOT EDIT\\n \\n+func Pselect(nfd int, r *FdSet, w *FdSet, e *FdSet, timeout *Timespec, sigmask *Sigset_t) (n int, err error) {\\n+\\tr0, _, e1 := Syscall6(SYS_PSELECT6, uintptr(nfd), uintptr(unsafe.Pointer(r)), uintptr(unsafe.Pointer(w)), uintptr(unsafe.Pointer(e)), uintptr(unsafe.Pointer(timeout)), uintptr(unsafe.Pointer(sigmask)))\\n+\\tn = int(r0)\\n+\\tif e1 != 0 {\\n+\\t\\terr = errnoErr(e1)\\n+\\t}\\n+\\treturn\\n+}\\n+\\n+// THIS FILE IS GENERATED BY THE COMMAND AT THE TOP; DO NOT EDIT\\n+\\n func read(fd int, p []byte) (n int, err error) {\\n \\tvar _p0 unsafe.Pointer\\n \\tif len(p) > 0 {\\n";
            // var diff2htmlUi = new Diff2HtmlUI({diff: lineDiffExample});
            // diff2htmlUi.draw('.diffs', {inputFormat: 'diff', showFiles: true, matching: 'lines'});
            // var customInput = "--- Makefile\n+++ Makefile\n@@ -35,8 +35,7 @@ uninstall: if [ -f llvm_mode/build ]; cd llvm_mode/build; xargs rm <install_manifest.txt; fi distclean:\n- cd qemu_mode; git clean -fxd; cd ..;\n- rm -rf llvm_mode/build\n+ git clean -fxd\nclean: cd llvm_mode/build; if [ -f Makefile ]; then make clean; fi "
            // var strInput = "--- a/server/vendor/golang.org/x/sys/unix/zsyscall_linux_mipsle.go\n+++ b/server/vendor/golang.org/x/sys/unix/zsyscall_linux_mipsle.go\n@@ -1035,6 +1035,17 @@ func Prctl(option int, arg2 uintptr, arg3 uintptr, arg4 uintptr, arg5 uintptr) (\n \n // THIS FILE IS GENERATED BY THE COMMAND AT THE TOP; DO NOT EDIT\n \n+func Pselect(nfd int, r *FdSet, w *FdSet, e *FdSet, timeout *Timespec, sigmask *Sigset_t) (n int, err error) {\n+\tr0, _, e1 := Syscall6(SYS_PSELECT6, uintptr(nfd), uintptr(unsafe.Pointer(r)), uintptr(unsafe.Pointer(w)), uintptr(unsafe.Pointer(e)), uintptr(unsafe.Pointer(timeout)), uintptr(unsafe.Pointer(sigmask)))\n+\tn = int(r0)\n+\tif e1 != 0 {\n+\t\terr = errnoErr(e1)\n+\t}\n+\treturn\n+}\n+\n+// THIS FILE IS GENERATED BY THE COMMAND AT THE TOP; DO NOT EDIT\n+\n func read(fd int, p []byte) (n int, err error) {\n \tvar _p0 unsafe.Pointer\n \tif len(p) > 0 {\n";
            // var output1 = Diff2Html.getPrettyHtml(customInput, {inputFormat: 'diff', showFiles: true, matching: 'lines'});
            // var output2 = Diff2Html.getPrettyHtml(strInput, {inputFormat: 'diff', showFiles: true, matching: 'lines'});
            // console.log(output);
            // $('#line-by-line').html(output1);
            // $('#line-by-line2').html(output2);
            // diff2htmlUi.draw('#line-by-line', {inputFormat: 'diff', showFiles: false, matching: 'lines'});
            // diff2htmlUi.highlightCode('#line-by-line');
        });
    </script>
{% endblock %}